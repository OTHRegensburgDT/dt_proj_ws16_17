<UserControl x:Class="MotorXPGUIMVVM.UserControls.DataDisplay"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:gauge="clr-namespace:MotorXPGUIMVVM.Controls.Gauge"
             xmlns:lineChart="clr-namespace:MotorXPGUIMVVM.Controls.LineChart"
             mc:Ignorable="d" 
             Name="UcContainer"
             d:DesignHeight="800" d:DesignWidth="600" 
             DataContext="{Binding DataDisplayViewModel, Source={StaticResource Locator}}">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Controls/Gauge/GaugeResources.xaml"/>
                <ResourceDictionary Source="../Controls/LineChart/LineChartResources.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>
    <ItemsControl Width="{Binding ElementName=UcContainer, Path=Width}"  ItemsSource="{Binding Repository.SensorDataCollections}">
        <ItemsControl.ItemTemplate>
            <DataTemplate>
                <Expander Name="Expander"  Header="{Binding Unit}" IsExpanded="True" Padding="8">
                    <Expander.Content>
                        <StackPanel Orientation="Horizontal">
                            <Border BorderBrush="LightGray" BorderThickness="0.5" MinWidth="100" MinHeight="50" >
                                <Border.Effect>
                                    <DropShadowEffect BlurRadius="6" Color="LightGray"></DropShadowEffect>
                                </Border.Effect>
                                <Grid Name="GaugeGrid" Background="White" >
                                    <Viewbox StretchDirection="Both" Stretch="Uniform">
                                        <StackPanel>
                                            <Grid>
                                                <gauge:Gauge  Grid.Row="0" Grid.Column="0" Width="120" Height="100" VerticalAlignment="Top" MaxAngle="1.6" 
                                             MinValue="{Binding MinValue}" MaxValue="{Binding MaxValue}" MinAngle="-1.6" NeedleColor="Transparent"
                                             GaugeBorderBrush="Transparent" NeedleBorderBrush="Red" Value="{Binding TargetValue}"
                                             Margin="0 8 0 -10" StrokeColor="Transparent" x:Name="Gauge2" MinMaxValueIndicatorBrush="Transparent"
                                             Foreground="Transparent" GaugeFill="Transparent"/>
                                                <gauge:Gauge  Grid.Column="0" Grid.Row="0" Width="120" Height="100" VerticalAlignment="Top" MaxAngle="1.6"  
                                             MaxValue="{Binding MaxValue}" MinAngle="-1.6" GaugeBorderBrush="Transparent" NeedleBorderBrush="Gray" 
                                             NeedleColor="White" Margin="0 8 0 -10" StrokeColor="PowderBlue" x:Name="Gauge" FontSize="10"
                                             MinMaxValueIndicatorBrush="Black" GaugeFill="Transparent" ValueIndicatorSize="20" Strokes="10"
                                             StrokeLength="0.6" StrokeThickness="3" Value="{Binding LastValue}" MinValue="{Binding MinValue}"/>
                                            </Grid>
                                            <!--Gauge slider-->
                                            <Slider Name="SliderGauge" Margin="8 0" TickPlacement="BottomRight" TickFrequency="{Binding GaugeTickFrequency}" Minimum="{Binding MinValue}"
                                            Width="100" 
                                        Maximum="{Binding MaxValue}" Value="{Binding TargetValue, Mode=TwoWay}" IsSnapToTickEnabled="True"/>
                                            <!--Gauge Text area-->
                                            <StackPanel Orientation="Horizontal" Margin="8 0 8 0">
                                                <Label FontSize="16" Content="Target Value:" VerticalContentAlignment="Top" VerticalAlignment="Top"></Label>
                                                <TextBox FontSize="16" Width="50" Height="26" Text="{Binding ElementName=SliderGauge, Path=Value, 
                                            UpdateSourceTrigger=PropertyChanged , Mode=TwoWay}"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Viewbox>
                                </Grid>
                            </Border>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="100"/>
                                    <RowDefinition Height="22"/>
                                    <RowDefinition Height="30"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="200"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <!--Gauge Column-->
                                <!--LineChart Column-->
                                <!--Value LineChart-->
                                <lineChart:LineChart Grid.Column="1" Grid.Row="0" Values="{Binding Values}" AutoMinMax="False" Margin="5 0"  
                                                     SampleWindow="10" IsShowingAll="{Binding ShowAll, Mode=TwoWay}" x:Name="LineChart" Background="White" 
                                                     StrokeColor="Blue" FillColor="MintCream" FontSize="10" AxisColor="DarkGray"/>
                                <!--Target LineChart-->
                                <!--
                            <lineChart:LineChart Grid.Column="1" Grid.Row="0" MinWidth="200" Values="{Binding TargetValue}" AutoMinMax="False" Margin="5 0"  
                                                     SampleWindow="10" IsShowingAll="{Binding ShowAll, Mode=TwoWay}" x:Name="LineChartTarget" Background="Transparent" 
                                                     StrokeColor="Red" FillColor="Transparent" FontSize="10" AxisColor="Transparent"/>-->

                                <!--LineChart slider-->
                                <Slider Name="SliderLineChart"  Grid.Column="1" Grid.Row="1"  Minimum="0" Margin="{Binding ElementName=LineChart, Path=Margin}" Maximum="1" 
                                        Width="{Binding ElementName=LineChart, Path=Width}" Value="{Binding ElementName=LineChart, Path=WindowPosition}" 
                                        ToolTip="{Binding CurrentValue}" DockPanel.Dock="Bottom"/>

                                <DockPanel Grid.Column="1" Grid.Row="2" >
                                    <Label Content="{Binding CurrentValueText}" FontSize="12" DockPanel.Dock="Left"></Label>
                                    <CheckBox DockPanel.Dock="Right" HorizontalAlignment="Right" Content="Show All" Command="{Binding ShowAllCommand}" IsChecked="{Binding ShowAll}"/>
                                </DockPanel>
                            </Grid>
                        </StackPanel>
                    </Expander.Content>
                </Expander>
            </DataTemplate>
        </ItemsControl.ItemTemplate>
        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <UniformGrid Columns="1"/>
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
    </ItemsControl>
</UserControl>
